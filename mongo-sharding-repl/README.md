# MongoDB Sharded Cluster —Å –†–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–∞:

1. **Config Server Replica Set** (1 —É–∑–µ–ª)
   - `configsvr:27019` - —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ (–≤ —Ä–µ–∂–∏–º–µ replica set)

2. **Shard 1 Replica Set** (3 —É–∑–ª–∞)
   - `shard1_primary:27018` (Primary, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 10)
   - `shard1_secondary1:27018` (Secondary, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5)
   - `shard1_secondary2:27018` (Secondary, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

3. **Shard 2 Replica Set** (3 —É–∑–ª–∞) 
   - `shard2_primary:27020` (Primary, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 10)
   - `shard2_secondary1:27020` (Secondary, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5)
   - `shard2_secondary2:27020` (Secondary, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

4. **MongoDB Router** (mongos)
   - `mongos:27017` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

5. **API Application**
   - `pymongo_api:8080` - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞


### 1. –ó–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (7 —É–∑–ª–æ–≤ MongoDB + mongos + API)
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–ª–∞—Å—Ç–µ—Ä–∞
./scripts/mongo-init.sh
```

–°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Config Server**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ config server

2. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Shard 1 Replica Set** 
   - –°–æ–∑–¥–∞–Ω–∏–µ replica set —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ primary —É–∑–ª–∞

3. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Shard 2 Replica Set**
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Shard 1
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

4. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —à–∞—Ä–¥–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è replica sets –≤ mongos
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

5. **–°–æ–∑–¥–∞–Ω–∏–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏**
   - –í–∫–ª—é—á–µ–Ω–∏–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –±–∞–∑—ã `somedb`
   - –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `helloDoc` —Å hashed sharding

6. **–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏**
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ 5000 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —à–∞—Ä–¥–∞–º

7. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞**
   - –í—ã–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö replica sets
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

#### –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **–û—Å–Ω–æ–≤–Ω–æ–π API**: http://localhost:8080
- **Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://localhost:8080/docs

#### –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å –∫–ª–∞—Å—Ç–µ—Ä–∞
docker compose exec -T mongos mongosh --port 27017 --quiet --eval "sh.status()"
````

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Config Server
```bash
docker compose exec -T configsvr mongosh --port 27019 --quiet --eval "db.adminCommand('ping')"
```

### –°—Ç–∞—Ç—É—Å Shard 1 Replica Set  
```bash
docker compose exec -T shard1_primary mongosh --port 27018 --quiet --eval "rs.status()"
```

### –°—Ç–∞—Ç—É—Å Shard 2 Replica Set
```bash
docker compose exec -T shard2_primary mongosh --port 27020 --quiet --eval "rs.status()"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Primary/Secondary —É–∑–ª–æ–≤
```bash
# –ö–∞–∫–æ–π —É–∑–µ–ª —è–≤–ª—è–µ—Ç—Å—è Primary –¥–ª—è –∫–∞–∂–¥–æ–≥–æ replica set
docker compose exec -T shard1_primary mongosh --port 27018 --quiet --eval "db.hello().isWritablePrimary"  
docker compose exec -T shard2_primary mongosh --port 27020 --quiet --eval "db.hello().isWritablePrimary"
```
